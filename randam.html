<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>荒野行動 縛りルーレット</title>
<style>
html, body {height:100%; margin:0; font-family:Arial,sans-serif; background:#f2f2f2;}
#setup, #roulette, #allResults {display:none; flex-direction:column; justify-content:center; align-items:center; height:100vh;}
#result {font-size:6vw; text-align:center; padding:20px; background:#fff; border-radius:10px; margin-bottom:20px; box-shadow:0 4px 8px rgba(0,0,0,0.15);}
button {font-size:18px; padding:12px 25px; margin:10px; cursor:pointer; border:none; border-radius:6px; background:#4CAF50; color:white;}
button:hover {background:#45a049;}
input {font-size:18px; margin:5px; padding:8px;}
#currentPlayer {font-size:2em; color:#222; margin:10px 0 5px 0; text-align:center;}
#matchInfo {font-size:1.5em; color:#555; margin-bottom:15px; text-align:center;}
.resultBox {background:#fff; border-radius:8px; padding:10px; margin:5px; width:80%; box-shadow:0 2px 6px rgba(0,0,0,0.1);}
.resultBox h3 {margin:0 0 5px 0;}
#backBtn {background:#f44336;}
#backBtn:hover {background:#d32f2f;}
</style>
</head>
<body>

<div id="setup">
  <h2>🎮 人数を入力（最大5人）</h2>
  <input type="number" id="playerCount" min="1" max="5" placeholder="人数を入力 (1〜5)">
  <button id="setPlayers">次へ ➡</button>
  <div id="nameInputs"></div>
  <button id="startBtn" style="display:none;">ルーレットへ進む</button>
</div>

<div id="roulette">
  <h1>🎯 荒野行動 縛りルーレット</h1>
  <h2 id="currentPlayer"></h2>
  <div id="matchInfo"></div>
  <div id="result">結果表示はここ</div>
  <button id="shuffleBtn">縛りルーレット 🎲</button>
  <button id="nextPlayerBtn" style="display:none;">次のプレイヤーへ ➡</button>
  <button id="nextMatchBtn" style="display:none;">次の試合へ 🏁</button>
  <button id="viewResultBtn">結果一覧を見る 📋</button>
  <button id="resetBtn">リセット 🔁</button>
</div>

<div id="allResults">
  <h1>📋 全試合結果</h1>
  <div id="resultsContainer" style="width:90%; max-height:80vh; overflow-y:auto;"></div>
  <button id="backBtn">× 戻る</button>
</div>

<script>
const weapons = [
 "95式","G36C","AR18","M4A1","M4A4","SCAR-L","AK-47","SCAR-H","M16A4","AUG","RN94","AK14","M27","81式","HK50","AKAIpha","MC-X","ADS","APS",
 "Dual TMP","UZI","MK5","MP5","PP2000","05式","トンプソン","P90",
 "LSR-8","AWM","CS","AMR-83","Kar98k","M24","ゴールデンクマ","M1891","爆裂弓","SVD","Val","88式","56式","クロスボウ",
 "M860","M88C","SK12",
 "ガトリングガン","MK60","95式軽機関銃"
];

let players = [];
let currentIndex = 0;
let matchCount = parseInt(localStorage.getItem("matchCount") || "1");
let results = JSON.parse(localStorage.getItem("rouletteResults") || "{}");
let currentMatchResults = {}; // 今の試合での回数管理

const setupDiv = document.getElementById("setup");
const rouletteDiv = document.getElementById("roulette");
const allResultsDiv = document.getElementById("allResults");
const resultDiv = document.getElementById("result");
const currentPlayerEl = document.getElementById("currentPlayer");
const matchInfoEl = document.getElementById("matchInfo");
const resultsContainer = document.getElementById("resultsContainer");

// 人数入力
document.getElementById("setPlayers").addEventListener("click", ()=>{
  const count = parseInt(document.getElementById("playerCount").value);
  const nameInputs = document.getElementById("nameInputs");
  nameInputs.innerHTML="";
  if(count>=1 && count<=5){
    for(let i=0;i<count;i++){
      const input=document.createElement("input");
      input.type="text";
      input.placeholder=`プレイヤー${i+1}の名前`;
      nameInputs.appendChild(input);
    }
    document.getElementById("startBtn").style.display="block";
  }
});

// 名前入力 → ルーレット画面
document.getElementById("startBtn").addEventListener("click", ()=>{
  const inputs = document.querySelectorAll("#nameInputs input");
  players = Array.from(inputs).map(i=>i.value.trim()).filter(n=>n!=="");
  if(players.length===0) return alert("名前を入力してください！");
  setupDiv.style.display="none";
  rouletteDiv.style.display="flex";
  currentIndex=0;
  currentMatchResults={};
  showPlayer();
});

// 現在のプレイヤー表示
function showPlayer(){
  if(currentIndex<players.length){
    const name=players[currentIndex];
    currentPlayerEl.innerHTML=`🎮 現在のプレイヤー：<strong>${name}</strong>`;
    matchInfoEl.innerHTML=`🏆 第${matchCount}試合`;
    resultDiv.innerHTML="結果表示はここ";
    document.getElementById("nextPlayerBtn").style.display="none";
    document.getElementById("nextMatchBtn").style.display="none";
  }else{
    document.getElementById("nextPlayerBtn").style.display="none";
    document.getElementById("nextMatchBtn").style.display="block";
  }
}

// ランダム取得
function pickUniqueRandom(arr,count){
  const n=Math.min(count,arr.length);
  const copy=arr.slice();
  const picked=[];
  for(let i=0;i<n;i++){
    const idx=Math.floor(Math.random()*copy.length);
    picked.push(copy.splice(idx,1)[0]);
  }
  return picked;
}

// ルーレット
function startRoulette(){
  const name = players[currentIndex];
  if(!currentMatchResults[name]) currentMatchResults[name]=0;
  currentMatchResults[name]++;
  const isPunishment = currentMatchResults[name]>1; // 2回目以降

  let pickCount = Math.random()<0.5?1:2;
  let finalPicked = pickUniqueRandom(weapons, pickCount);

  if(isPunishment){
    const punishmentText = prompt("罰ゲームは？", "罰ゲーム内容");
    if(punishmentText){
      finalPicked[0] = `${finalPicked[0]} (罰ゲーム：${punishmentText})`;
    }
  }

  let count=0;
  const steps=60;
  const interval = setInterval(()=>{
    const random1 = weapons[Math.floor(Math.random()*weapons.length)];
    const random2 = weapons[Math.floor(Math.random()*weapons.length)];
    resultDiv.innerHTML = `${name} の縛り中...<br>${random1}<br>${random2}`;
    count++;
    if(count>=steps){
      clearInterval(interval);
      // 結果表示
      resultDiv.innerHTML = `${name} の縛り結果<br>1. ${finalPicked[0]}<br>2. ${finalPicked[1]||"自由な武器"}`;

      // 保存（1. 2. の武器名で保存）
      const matchKey = `試合${matchCount}_${name}`;
      results[matchKey] = {
        title: `第${matchCount}試合`,
        name,
        shibari: [`1. ${finalPicked[0]}`, `2. ${finalPicked[1]||"自由な武器"}`]
      };
      localStorage.setItem("rouletteResults", JSON.stringify(results));

      document.getElementById("nextPlayerBtn").style.display="block";
    }
  },50);
}


// ボタン
document.getElementById("shuffleBtn").addEventListener("click", startRoulette);
document.getElementById("nextPlayerBtn").addEventListener("click", ()=>{
  currentIndex++;
  showPlayer();
});
document.getElementById("nextMatchBtn").addEventListener("click", ()=>{
  matchCount++;
  localStorage.setItem("matchCount", matchCount);
  currentIndex=0;
  currentMatchResults={};
  showPlayer();
});
document.getElementById("viewResultBtn").addEventListener("click", ()=>{
  // 全試合表示
  rouletteDiv.style.display="none";
  allResultsDiv.style.display="flex";
  resultsContainer.innerHTML="";
  const grouped = {};
  Object.values(results).forEach(r=>{
    if(!grouped[r.title]) grouped[r.title]=[];
    grouped[r.title].push(r);
  });
  for(const match in grouped){
    const box = document.createElement("div");
    box.className="resultBox";
    let html = `<h3>🏆 ${match}</h3>`;
    grouped[match].forEach(r=>{
      html += `👤 ${r.name} 🔫 ${r.shibari.join(", ")}<br>`;
    });
    box.innerHTML=html;
    resultsContainer.appendChild(box);
  }
});

document.getElementById("backBtn").addEventListener("click", ()=>{
  allResultsDiv.style.display="none";
  rouletteDiv.style.display="flex";
});

document.getElementById("resetBtn").addEventListener("click", ()=>{
  if(confirm("リセットしますか？保存データが全て消えます。")){
    localStorage.removeItem("rouletteResults");
    localStorage.removeItem("matchCount");
    results={};
    matchCount=1;
    location.reload();
  }
});
  
// 初期表示
window.onload = () => {
  const storedResults = localStorage.getItem("rouletteResults");
  const storedMatchCount = localStorage.getItem("matchCount");

  if(storedResults || storedMatchCount){
    // 保存データがある場合
    if(confirm("保存データが存在します。破棄しますか？\n\nはい: 消してリセット\nいいえ: 続きから")){
      // データ削除
      localStorage.removeItem("rouletteResults");
      localStorage.removeItem("matchCount");
      results = {};
      matchCount = 1;
      players = [];
      setupDiv.style.display = "flex";
      rouletteDiv.style.display = "none";
      allResultsDiv.style.display = "none";
    } else {
      // データを読み込み
      results = JSON.parse(storedResults || "{}");
      matchCount = parseInt(storedMatchCount || "1");

      // 前回の試合に参加したプレイヤーを取得
      players = Object.values(results)
                      .filter(r => r.title === `第${matchCount}試合`)
                      .map(r => r.name);

      if(players.length > 0){
        setupDiv.style.display = "none";
        rouletteDiv.style.display = "flex";
        currentIndex = 0;
        currentMatchResults = {};
        showPlayer();
      } else {
        setupDiv.style.display = "flex";
      }
    }
  } else {
    // 保存データがない場合は通常の初期画面
    setupDiv.style.display = "flex";
  }
};
</script>
</body>
</html>



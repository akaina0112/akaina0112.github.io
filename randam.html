<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>荒野行動 縛りルーレット</title>
<style>
html, body {
  margin: 0;
  padding: 0;
  font-family: "Arial", sans-serif;
  background-color: #f2f2f2;
  height: 100%;
  text-align: center;
}
#setup, #roulette {
  display: none;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}
#setup.active, #roulette.active {
  display: flex;
}
input {
  padding: 10px;
  margin: 5px;
  font-size: 16px;
  border-radius: 5px;
  border: 1px solid #aaa;
}
button {
  font-size: 18px;
  padding: 10px 20px;
  margin: 10px;
  cursor: pointer;
  border-radius: 5px;
  border: none;
  background-color: #4CAF50;
  color: white;
}
button:hover {
  background-color: #45a049;
}
#result {
  font-size: 6vw;
  padding: 20px;
}
</style>
</head>
<body>

<h1>🎯 荒野行動 縛りルーレット</h1>

<!-- 人数・名前入力画面 -->
<div id="setup" class="active">
  <div>
    <p>人数を選択（最大5人）</p>
    <input type="number" id="playerCount" min="1" max="5" value="1">
    <button id="setCountBtn">OK</button>
  </div>
  <div id="nameInputs"></div>
  <button id="saveNamesBtn" style="display:none;">次へ ▶</button>
</div>

<!-- ルーレット画面 -->
<div id="roulette">
  <h2 id="currentTitle"></h2>
  <select id="playerSelect"></select>
  <div id="result">結果表示はここ</div>
  <button id="shuffleBtn">縛りルーレット 🎲</button>
  <button id="resetBtn" style="background-color:red;">リセット</button>
</div>

<script>
const weapons = [
  "95式","G36C","AR18","M4A1","M4A4","SCAR-L","AK-47","SCAR-H","M16A4","AUG","RN94","AK14","M27","81式","HK50","AKAIpha","MC-X","ADS","APS",
  "Dual TMP","UZI","MK5","MP5","PP2000","05式","トンプソン","P90",
  "LSR-8","AWM","CS","AMR-83","Kar98k","M24","ゴールデンクマ","M1891","爆裂弓","SVD","Val","88式","56式","クロスボウ",
  "M860","M88C","SK12",
  "ガトリングガン","MK60","95式軽機関銃"
];

const setupDiv = document.getElementById("setup");
const rouletteDiv = document.getElementById("roulette");
const nameInputsDiv = document.getElementById("nameInputs");
const saveNamesBtn = document.getElementById("saveNamesBtn");
const playerSelect = document.getElementById("playerSelect");
const resultDiv = document.getElementById("result");
const titleEl = document.getElementById("currentTitle");

let players = JSON.parse(localStorage.getItem("players")) || [];
let matchCount = parseInt(localStorage.getItem("matchCount")) || 1;

// ページ読み込み時
window.onload = () => {
  if (players.length > 0) {
    startRouletteScreen();
  } else {
    setupDiv.classList.add("active");
  }
};

// 人数設定
document.getElementById("setCountBtn").addEventListener("click", () => {
  const count = parseInt(document.getElementById("playerCount").value);
  nameInputsDiv.innerHTML = "";
  for (let i = 0; i < count; i++) {
    nameInputsDiv.innerHTML += `<input type="text" id="player${i}" placeholder="プレイヤー${i+1}の名前">`;
  }
  saveNamesBtn.style.display = "inline-block";
});

// 名前保存
saveNamesBtn.addEventListener("click", () => {
  players = [];
  const count = parseInt(document.getElementById("playerCount").value);
  for (let i = 0; i < count; i++) {
    const name = document.getElementById(`player${i}`).value.trim();
    if (name) players.push({ name, result: null });
  }
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("matchCount", matchCount);
  startRouletteScreen();
});

// ルーレット画面に切り替え
function startRouletteScreen() {
  setupDiv.classList.remove("active");
  rouletteDiv.classList.add("active");
  playerSelect.innerHTML = players.map(p => `<option value="${p.name}">${p.name}</option>`).join("");
  titleEl.textContent = `${matchCount}試合目`;
}

// ランダム選択
function pickUniqueRandom(arr, count) {
  const copy = arr.slice();
  const picked = [];
  for (let i = 0; i < count; i++) {
    const idx = Math.floor(Math.random() * copy.length);
    picked.push(copy.splice(idx, 1)[0]);
  }
  return picked;
}

// ルーレット実行
document.getElementById("shuffleBtn").addEventListener("click", () => {
  const selectedName = playerSelect.value;
  const player = players.find(p => p.name === selectedName);
  const pickCount = Math.random() < 0.5 ? 1 : 2;
  const finalPicked = pickUniqueRandom(weapons, pickCount);

  if (player.result) {
    // 2回目以降：罰ゲーム
    resultDiv.innerHTML = `⚠️ ${player.name}は2回目！罰ゲーム！<br>新しい縛りに上書きされました💀<br><br>1. ${finalPicked[0]}<br>2. ${finalPicked[1] || "自由"}`;
  } else {
    // 初回
    resultDiv.innerHTML = `${player.name}の縛り：<br>1. ${finalPicked[0]}<br>2. ${finalPicked[1] || "自由"}`;
  }

  // 結果保存
  player.result = finalPicked;
  localStorage.setItem("players", JSON.stringify(players));
});

// リセット
document.getElementById("resetBtn").addEventListener("click", () => {
  localStorage.clear();
  location.reload();
});
</script>

</body>
</html>

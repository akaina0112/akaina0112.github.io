<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>荒野行動 縛りルーレット</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: #f2f2f2;
  font-family: Arial, sans-serif;
}

#container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#rest {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  width: 100vw;
}

#result {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 6vw;
  text-align: center;
  min-height: 40%;
  width: 90%;
  background-color: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}

button {
  font-size: 18px;
  padding: 12px 25px;
  margin: 8px;
  cursor: pointer;
  border-radius: 5px;
  border: none;
  background-color: #4CAF50;
  color: white;
  transition: background 0.2s;
}

button:hover {
  background-color: #45a049;
}

input {
  padding: 10px;
  font-size: 16px;
  margin: 5px;
}

.box {
  background-color: #fff;
  padding: 10px;
  margin: 8px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  text-align: left;
  width: 90%;
}
</style>
</head>
<body>
<div id="container"></div>

<script>
const weapons = [
  "95式","G36C","AR18","M4A1","M4A4","SCAR-L","AK-47","SCAR-H","M16A4","AUG","RN94","AK14","M27","81式","HK50","AKAIpha","MC-X","ADS","APS",
  "Dual TMP","UZI","MK5","MP5","PP2000","05式","トンプソン","P90",
  "LSR-8","AWM","CS","AMR-83","Kar98k","M24","ゴールデンクマ","M1891","爆裂弓","SVD","Val","88式","56式","クロスボウ",
  "M860","M88C","SK12",
  "ガトリングガン","MK60","95式軽機関銃"
];

let players = JSON.parse(localStorage.getItem("players")) || [];
let results = JSON.parse(localStorage.getItem("results")) || [];
let matchCount = results.length + 1;

const container = document.getElementById("container");

function saveData() {
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("results", JSON.stringify(results));
}

function showPlayerCountInput() {
  container.innerHTML = `
    <h1>🎮 荒野行動 縛りルーレット</h1>
    <p>参加人数を選択してください（最大5人）</p>
    <input type="number" id="countInput" min="1" max="5" value="1">
    <button id="nextBtn">次へ</button>
  `;
  document.getElementById("nextBtn").onclick = () => {
    const count = parseInt(document.getElementById("countInput").value);
    if (count < 1 || count > 5) return alert("1〜5の人数を入力してください。");
    showNameInput(count);
  };
}

function showNameInput(count) {
  let inputs = "";
  for (let i = 0; i < count; i++) {
    inputs += `<input type="text" id="name${i}" placeholder="プレイヤー${i+1}の名前"><br>`;
  }
  container.innerHTML = `
    <h2>名前を入力してください</h2>
    ${inputs}
    <button id="saveNamesBtn">次へ</button>
  `;
  document.getElementById("saveNamesBtn").onclick = () => {
    players = [];
    for (let i = 0; i < count; i++) {
      const name = document.getElementById(`name${i}`).value.trim() || `プレイヤー${i+1}`;
      players.push(name);
    }
    saveData();
    showMatchScreen();
  };
}

function pickUniqueRandom(arr, count) {
  const n = Math.min(count, arr.length);
  const copy = arr.slice();
  const picked = [];
  for (let i = 0; i < n; i++) {
    const idx = Math.floor(Math.random() * copy.length);
    picked.push(copy.splice(idx, 1)[0]);
  }
  return picked;
}

function startRoulette(player) {
  const pickCount = Math.random() < 0.5 ? 1 : 2;
  const finalPicked = pickUniqueRandom(weapons, pickCount);
  const resultDiv = document.getElementById("result");
  let count = 0;
  const steps = 60;

  const interval = setInterval(() => {
    const random1 = weapons[Math.floor(Math.random() * weapons.length)];
    const random2 = weapons[Math.floor(Math.random() * weapons.length)];
    resultDiv.innerHTML = `${player} の縛り中...<br>${random1}<br>${random2}`;
    count++;
    if (count >= steps) {
      clearInterval(interval);
      resultDiv.innerHTML = `${player} の縛り結果<br>1. ${finalPicked[0]}<br>2. ${finalPicked[1] || "自由な武器"}`;

      // 試合結果の配列を作成
      if (!results[matchCount - 1]) {
        results[matchCount - 1] = { title: `第${matchCount}試合`, data: [] };
      }

      // 同じプレイヤーが2回目以降なら罰ゲーム
      const matchData = results[matchCount - 1].data;
      const existing = matchData.find(r => r.name === player);
      if (existing) {
        const punishment = prompt(`${player} はこの試合で2回目です！罰ゲームは？`) || "なし";
        existing.punishment = punishment;
      } else {
        matchData.push({ name: player, shibari: finalPicked });
      }

      saveData();
    }
  }, 50);
}

function showMatchScreen() {
  container.innerHTML = `
  <div id="rest">
    <h2>第${matchCount}試合</h2>
    <div id="result">ここに結果が出ます</div>
    <div>${players.map(p => `<button class="playerBtn">${p}</button>`).join("")}</div>
    <button id="nextMatch">次の試合へ</button>
    <button id="viewResults">結果を見る</button>
    <button id="resetBtn">リセット</button>
  </div>
  `;
  document.querySelectorAll(".playerBtn").forEach(btn => {
    btn.onclick = () => startRoulette(btn.textContent);
  });
  document.getElementById("nextMatch").onclick = () => {
    matchCount++;
    showMatchScreen();
  };
  document.getElementById("viewResults").onclick = showResults;
  document.getElementById("resetBtn").onclick = resetAll;
}

function showResults() {
  container.innerHTML = `
    <h2>📜 試合ごとの結果</h2>
    ${results.map(match => `
      <div class="box">
        <h3>${match.title}</h3>
        ${match.data.map(r => `
          👤${r.name}<br>
          🔫${r.shibari.join(", ")}<br>
          ${r.punishment ? `⚠️罰ゲーム：${r.punishment}` : ""}
          <hr>
        `).join("")}
      </div>
    `).join("") || "まだ結果がありません"}
    <button id="backBtn">戻る</button>
  `;
  document.getElementById("backBtn").onclick = showMatchScreen;
}

function resetAll() {
  if (confirm("すべてリセットしますか？")) {
    localStorage.clear();
    players = [];
    results = [];
    matchCount = 1;
    showPlayerCountInput();
  }
}

// 初期画面表示
if (players.length === 0) {
  showPlayerCountInput();
} else {
  showMatchScreen();
}
</script>
</body>
</html>

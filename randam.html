<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: #f2f2f2;
  font-family: Arial, sans-serif;
  text-align: center;
}

#container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

button {
  font-size: 18px;
  padding: 12px 25px;
  margin: 10px;
  cursor: pointer;
  border-radius: 5px;
  border: none;
  background-color: #4CAF50;
  color: white;
  transition: background 0.2s;
}

button:hover {
  background-color: #45a049;
}

input {
  padding: 10px;
  font-size: 16px;
  margin: 5px;
}
</style>
</head>
<body>
<div id="container"></div>

<script>
const weapons = [
  "95å¼","G36C","AR18","M4A1","M4A4","SCAR-L","AK-47","SCAR-H","M16A4","AUG","RN94","AK14","M27","81å¼","HK50","AKAIpha","MC-X","ADS","APS",
  "Dual TMP","UZI","MK5","MP5","PP2000","05å¼","ãƒˆãƒ³ãƒ—ã‚½ãƒ³","P90",
  "LSR-8","AWM","CS","AMR-83","Kar98k","M24","ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ","M1891","çˆ†è£‚å¼“","SVD","Val","88å¼","56å¼","ã‚¯ãƒ­ã‚¹ãƒœã‚¦",
  "M860","M88C","SK12",
  "ã‚¬ãƒˆãƒªãƒ³ã‚°ã‚¬ãƒ³","MK60","95å¼è»½æ©Ÿé–¢éŠƒ"
];

let players = JSON.parse(localStorage.getItem("players")) || [];
let results = JSON.parse(localStorage.getItem("results")) || [];
let matchCount = results.length + 1;

const container = document.getElementById("container");

function saveData() {
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("results", JSON.stringify(results));
}

function showPlayerCountInput() {
  container.innerHTML = `
    <h1>ğŸ® è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>
    <p>å‚åŠ äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§5äººï¼‰</p>
    <input type="number" id="countInput" min="1" max="5" value="1">
    <button id="nextBtn">æ¬¡ã¸</button>
  `;

  document.getElementById("nextBtn").onclick = () => {
    const count = parseInt(document.getElementById("countInput").value);
    if (count < 1 || count > 5) {
      alert("1ã€œ5ã®äººæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
      return;
    }
    showNameInput(count);
  };
}

function showNameInput(count) {
  let inputs = "";
  for (let i = 0; i < count; i++) {
    inputs += `<input type="text" id="name${i}" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}ã®åå‰"><br>`;
  }
  container.innerHTML = `
    <h2>åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
    ${inputs}
    <button id="saveNamesBtn">æ¬¡ã¸</button>
  `;

  document.getElementById("saveNamesBtn").onclick = () => {
    players = [];
    for (let i = 0; i < count; i++) {
      const name = document.getElementById(`name${i}`).value.trim() || `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}`;
      players.push(name);
    }
    saveData();
    showMatchScreen();
  };
}

function pickUniqueRandom(arr, count) {
  const n = Math.min(count, arr.length);
  const copy = arr.slice();
  const picked = [];
  for (let i = 0; i < n; i++) {
    const idx = Math.floor(Math.random() * copy.length);
    picked.push(copy.splice(idx, 1)[0]);
  }
  return picked;
}

function startRoulette(player) {
  const pickCount = Math.random() < 0.5 ? 1 : 2;
  const finalPicked = pickUniqueRandom(weapons, pickCount);
  const resultDiv = document.getElementById("result");
  let count = 0;
  const steps = 60;

  const interval = setInterval(() => {
    const random1 = weapons[Math.floor(Math.random() * weapons.length)];
    const random2 = weapons[Math.floor(Math.random() * weapons.length)];
    resultDiv.innerHTML = `${player} ã®ç¸›ã‚Šä¸­...<br>${random1}<br>${random2}`;
    count++;
    if (count >= steps) {
      clearInterval(interval);
      resultDiv.innerHTML = `${player} ã®ç¸›ã‚Šçµæœ<br>1. ${finalPicked[0]}<br>2. ${finalPicked[1] || "è‡ªç”±ãªæ­¦å™¨"}`;
      results.push({ title: `ç¬¬${matchCount}è©¦åˆ`, name: player, shibari: finalPicked });
      saveData();
    }
  }, 50);
}

function showMatchScreen() {
  container.innerHTML = `
    <h2>ç¬¬${matchCount}è©¦åˆ</h2>
    <div id="result">ã“ã“ã«çµæœãŒå‡ºã¾ã™</div>
    <div>${players.map(p => `<button class="playerBtn">${p}</button>`).join("")}</div>
    <button id="viewResults">çµæœã‚’è¦‹ã‚‹</button>
    <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
  `;

  document.querySelectorAll(".playerBtn").forEach(btn => {
    btn.onclick = () => startRoulette(btn.textContent);
  });

  document.getElementById("viewResults").onclick = showResults;
  document.getElementById("resetBtn").onclick = resetAll;
}

function showResults() {
  container.innerHTML = `
    <h2>ã“ã‚Œã¾ã§ã®çµæœ</h2>
    ${results.map(r => `<div>ğŸ·ï¸${r.title}ï½œğŸ‘¤${r.name}<br>ğŸ”«${r.shibari.join(", ")}</div><hr>`).join("") || "çµæœãªã—"}
    <button id="backBtn">æˆ»ã‚‹</button>
  `;
  document.getElementById("backBtn").onclick = showMatchScreen;
}

function resetAll() {
  if (confirm("ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    localStorage.clear();
    players = [];
    results = [];
    matchCount = 1;
    showPlayerCountInput();
  }
}

// ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
if (players.length === 0) {
  showPlayerCountInput();
} else {
  showMatchScreen();
}
</script>
</body>
</html>

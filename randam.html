<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>荒野行動 縛りルーレット</title>

<style>
html, body {height: 100%;margin: 0;font-family: Arial, sans-serif;background: #f2f2f2;}
#setup, #roulette, #allResults, #punishmentsContainer {display: none;flex-direction: column;justify-content: center;align-items: center;height: 100vh;}
#result {font-size: 6vw;text-align: center;padding: 20px;background: #fff;border-radius: 10px;margin-bottom: 20px;box-shadow: 0 4px 8px rgba(0,0,0,0.15);}
button {font-size: 18px;padding: 12px 25px;margin: 10px;cursor: pointer;border: none;border-radius: 6px;background: #4CAF50;color: white;}
button:hover {background: #45a049;}
input {font-size: 18px;margin: 5px;padding: 8px;}
#currentPlayer {font-size: 2em;color: #222;margin: 10px 0 5px 0;text-align: center;}
#matchInfo {font-size: 1.5em;color: #555;margin-bottom: 15px;text-align: center;}
.resultBox {background: #fff;border-radius: 8px;padding: 10px;margin: 10px auto;width: 80%;box-shadow: 0 2px 6px rgba(0,0,0,0.1);text-align: center;font-size: 1.5em;}
.resultBox h3 {margin: 0 0 5px 0;}
#backBtn, #closePunishmentsBtn {background: #f44336;}
#backBtn:hover, #closePunishmentsBtn:hover {background: #d32f2f;}
#resultsContainer, #punishmentsContent {width: 90%;max-height: 80vh;overflow-y: auto;}
#playerCount {width: 20%;}
</style>
</head>

<body>

<!-- 設定画面 -->
<div id="setup">
  <h2>🎮 人数を入力（最大5人）</h2>
  <input type="number" id="playerCount" min="1" max="5" placeholder="人数を入力 (1〜5)">
  <button id="setPlayers">決定</button>
  <div id="nameInputs"></div>
  <button id="startBtn" style="display:none;">ルーレットへ進む</button>
</div>

<!-- ルーレット画面 -->
<div id="roulette">
  <h1>🎯 荒野行動 縛りルーレット</h1>
  <h2 id="currentPlayer"></h2>
  <div id="matchInfo"></div>
  <div id="result">結果表示はここ</div>
  <button id="shuffleBtn">縛りルーレット 🎲</button>
  <button id="nextPlayerBtn" style="display:none;">次のプレイヤーへ ➡</button>
  <button id="nextMatchBtn" style="display:none;">次の試合へ 🏁</button>
  <button id="viewResultBtn">結果一覧を見る 📋</button>
  <button id="showPunishmentsBtn">罰ゲーム一覧を見る 🎯</button>
</div>

<!-- 結果一覧 -->
<div id="allResults">
  <h2>📋 結果一覧</h2>
  <div id="resultsContainer"></div>
  <button id="backBtn">× 閉じる</button>
</div>

<!-- 罰ゲーム一覧 -->
<div id="punishmentsContainer">
  <h2>🎯 罰ゲーム一覧</h2>
  <div id="punishmentsContent"></div>
  <button id="closePunishmentsBtn">× 閉じる</button>
</div>

<script>
const setupDiv = document.getElementById("setup");
const rouletteDiv = document.getElementById("roulette");
const allResultsDiv = document.getElementById("allResults");
const punishmentsDiv = document.getElementById("punishmentsContainer");
const playerCountInput = document.getElementById("playerCount");
const nameInputsDiv = document.getElementById("nameInputs");
const startBtn = document.getElementById("startBtn");
const shuffleBtn = document.getElementById("shuffleBtn");
const nextPlayerBtn = document.getElementById("nextPlayerBtn");
const nextMatchBtn = document.getElementById("nextMatchBtn");
const currentPlayerLabel = document.getElementById("currentPlayer");
const matchInfo = document.getElementById("matchInfo");
const resultDiv = document.getElementById("result");
const viewResultBtn = document.getElementById("viewResultBtn");
const showPunishmentsBtn = document.getElementById("showPunishmentsBtn");
const resultsContainer = document.getElementById("resultsContainer");
const punishmentsContent = document.getElementById("punishmentsContent");
const backBtn = document.getElementById("backBtn");
const closePunishmentsBtn = document.getElementById("closePunishmentsBtn");

const weapons = [
 "95式","G36C","AR18","M4A1","M4A4","SCAR-L","AK-47","SCAR-H","M16A4","AUG","RN94","AK14","M27","81式","HK50","AKAIpha","MC-X","ADS","APS",
 "Dual TMP","UZI","MK5","MP5","PP2000","05式","トンプソン","P90",
 "LSR-8","AWM","CS","AMR-83","Kar98k","M24","ゴールデンクマ","M1891","爆裂弓","SVD","Val","88式","56式","クロスボウ",
 "M860","M88C","SK12",
 "ガトリングガン","MK60","95式軽機関銃"
];
const bgColors = ["#fff", "#f9f0f0", "#f0f9f9", "#f0f0f9", "#f9f9f0", "#f8f0f8", "#f0f8f0", "#f8f8f0", "#f0f0f8"];

let players = [];
let currentPlayerIndex = 0;
let currentMatch = 1;
let results = JSON.parse(localStorage.getItem("results")) || {};
let punishments = JSON.parse(localStorage.getItem("punishments")) || {};

window.onload = () => {
  if (localStorage.getItem("results")) {
    if (confirm("保存データがあります。破棄しますか？")) {
      localStorage.clear();
    }
  }
  setupDiv.style.display = "flex";
};

// 人数入力後の名前入力
document.getElementById("setPlayers").onclick = () => {
  const count = parseInt(playerCountInput.value);
  if (isNaN(count) || count < 1 || count > 5) {
    alert("人数は1〜5人の間で入力してください。");
    return;
  }
  nameInputsDiv.innerHTML = "";
  for (let i = 0; i < count; i++) {
    const input = document.createElement("input");
    input.placeholder = `プレイヤー${i + 1}の名前`;
    input.id = `player${i}`;
    nameInputsDiv.appendChild(input);
  }
  startBtn.style.display = "block";
};

// 名前保存してルーレットへ
startBtn.onclick = () => {
  players = [];
  for (let i = 0; i < parseInt(playerCountInput.value); i++) {
    const val = document.getElementById(`player${i}`).value.trim();
    if (!val) {
      alert("全員の名前を入力してください。");
      return;
    }
    players.push(val);
  }
  setupDiv.style.display = "none";
  rouletteDiv.style.display = "flex";
  updatePlayerDisplay();
};

// 🎲 ルーレット演出付きボタン
shuffleBtn.onclick = async () => {
  const name = players[currentPlayerIndex];
  const key = `試合${currentMatch}`;
  results[key] = results[key] || {};

  if (results[key][name]) {
    const punishmentText = prompt("罰ゲームは？", "罰ゲーム内容");
    if (punishmentText === null) return; // キャンセルで中止
    await spinRoulette(2000); // ルーレットアニメーション
    const weapon1 = weapons[Math.floor(Math.random() * weapons.length)];
    const weapon2 = "自由な武器";
    results[key][name] = `${weapon1}, ${weapon2} (罰ゲーム：${punishmentText})`;
    punishments[name] = punishments[name] || [];
    punishments[name].push(`試合${currentMatch}：${punishmentText}`);
  } else {
    await spinRoulette(2000);
    const weapon1 = weapons[Math.floor(Math.random() * weapons.length)];
    const weapon2 = weapons[Math.floor(Math.random() * weapons.length)];
    results[key][name] = `${weapon1}, ${weapon2}`;
  }

  localStorage.setItem("results", JSON.stringify(results));
  localStorage.setItem("punishments", JSON.stringify(punishments));
  resultDiv.textContent = `${name} の結果：${results[key][name]}`;
  nextPlayerBtn.style.display = "inline-block";
};

// 🎞 ルーレット演出関数
function spinRoulette(duration = 2000) {
  return new Promise(resolve => {
    shuffleBtn.disabled = true;
    let count = 0;
    const interval = setInterval(() => {
      const w1 = weapons[Math.floor(Math.random() * weapons.length)];
      const w2 = weapons[Math.floor(Math.random() * weapons.length)];
      resultDiv.textContent = `🔄 ${w1}, ${w2}`;
      count += 100;
    }, 100);
    setTimeout(() => {
      clearInterval(interval);
      shuffleBtn.disabled = false;
      resolve();
    }, duration);
  });
}

// 次のプレイヤーへ
nextPlayerBtn.onclick = () => {
  currentPlayerIndex++;
  if (currentPlayerIndex >= players.length) {
    nextPlayerBtn.style.display = "none";
    nextMatchBtn.style.display = "inline-block";
  } else {
    updatePlayerDisplay();
    resultDiv.textContent = "結果表示はここ";
    nextPlayerBtn.style.display = "none";
  }
};

// 次の試合へ
nextMatchBtn.onclick = () => {
  currentMatch++;
  currentPlayerIndex = 0;
  resultDiv.textContent = "結果表示はここ";
  nextMatchBtn.style.display = "none";
  updatePlayerDisplay();
};

// 結果一覧表示
viewResultBtn.onclick = () => {
  rouletteDiv.style.display = "none";
  allResultsDiv.style.display = "flex";
  resultsContainer.innerHTML = "";
  let colorIndex = 0;

  for (const [match, playersData] of Object.entries(results)) {
    const box = document.createElement("div");
    box.className = "resultBox";
    box.style.background = bgColors[colorIndex % bgColors.length];
    colorIndex++;

    const h3 = document.createElement("h3");
    h3.textContent = match;
    box.appendChild(h3);

    for (const [name, result] of Object.entries(playersData)) {
      const p = document.createElement("p");
      p.textContent = `👤 ${name} 🔫 ${result}`;
      box.appendChild(p);
    }
    resultsContainer.appendChild(box);
  }
};

// 罰ゲーム一覧表示
showPunishmentsBtn.onclick = () => {
  rouletteDiv.style.display = "none";
  punishmentsDiv.style.display = "flex";
  punishmentsContent.innerHTML = "";
  let colorIndex = 0;

  for (const [name, list] of Object.entries(punishments)) {
    const box = document.createElement("div");
    box.className = "resultBox";
    box.style.background = bgColors[colorIndex % bgColors.length];
    colorIndex++;

    const h3 = document.createElement("h3");
    h3.textContent = name;
    box.appendChild(h3);

    list.forEach(item => {
      const p = document.createElement("p");
      p.textContent = item;
      box.appendChild(p);
    });
    punishmentsContent.appendChild(box);
  }
};

// 戻るボタン
backBtn.onclick = () => {
  allResultsDiv.style.display = "none";
  rouletteDiv.style.display = "flex";
};

// 罰ゲーム閉じる
closePunishmentsBtn.onclick = () => {
  punishmentsDiv.style.display = "none";
  rouletteDiv.style.display = "flex";
};

function updatePlayerDisplay() {
  const name = players[currentPlayerIndex];
  currentPlayerLabel.textContent = `🎮 現在のプレイヤー：${name}`;
  matchInfo.textContent = `試合 ${currentMatch}`;
}
</script>
</body>
</html>


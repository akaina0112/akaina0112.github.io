<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>
<style>
html, body {
  height: 100%;
  margin: 0;
  padding: 0;
  background-color: #f2f2f2;
  font-family: Arial, sans-serif;
}

#container {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

#rest {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  height: 100vh;
  width: 100vw;
}

#result {
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  font-size: 6vw;
  text-align: center;
  min-height: 40%;
  width: 90%;
  background-color: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
  margin-bottom: 20px;
}

button {
  font-size: 18px;
  padding: 12px 25px;
  margin: 8px;
  cursor: pointer;
  border-radius: 5px;
  border: none;
  background-color: #4CAF50;
  color: white;
  transition: background 0.2s;
}

button:hover {
  background-color: #45a049;
}

input {
  padding: 10px;
  font-size: 16px;
  margin: 5px;
}

.box {
  background-color: #fff;
  padding: 10px;
  margin: 8px;
  border-radius: 8px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.1);
  text-align: left;
  width: 90%;
}
</style>
</head>
<body>
<div id="container"></div>

<script>
const weapons = [
  "95å¼","G36C","AR18","M4A1","M4A4","SCAR-L","AK-47","SCAR-H","M16A4","AUG","RN94","AK14","M27","81å¼","HK50","AKAIpha","MC-X","ADS","APS",
  "Dual TMP","UZI","MK5","MP5","PP2000","05å¼","ãƒˆãƒ³ãƒ—ã‚½ãƒ³","P90",
  "LSR-8","AWM","CS","AMR-83","Kar98k","M24","ã‚´ãƒ¼ãƒ«ãƒ‡ãƒ³ã‚¯ãƒ","M1891","çˆ†è£‚å¼“","SVD","Val","88å¼","56å¼","ã‚¯ãƒ­ã‚¹ãƒœã‚¦",
  "M860","M88C","SK12",
  "ã‚¬ãƒˆãƒªãƒ³ã‚°ã‚¬ãƒ³","MK60","95å¼è»½æ©Ÿé–¢éŠƒ"
];

let players = JSON.parse(localStorage.getItem("players")) || [];
let results = JSON.parse(localStorage.getItem("results")) || [];
let matchCount = results.length + 1;

const container = document.getElementById("container");

function saveData() {
  localStorage.setItem("players", JSON.stringify(players));
  localStorage.setItem("results", JSON.stringify(results));
}

function showPlayerCountInput() {
  container.innerHTML = `
    <h1>ğŸ® è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>
    <p>å‚åŠ äººæ•°ã‚’é¸æŠã—ã¦ãã ã•ã„ï¼ˆæœ€å¤§5äººï¼‰</p>
    <input type="number" id="countInput" min="1" max="5" value="1">
    <button id="nextBtn">æ¬¡ã¸</button>
  `;
  document.getElementById("nextBtn").onclick = () => {
    const count = parseInt(document.getElementById("countInput").value);
    if (count < 1 || count > 5) return alert("1ã€œ5ã®äººæ•°ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");
    showNameInput(count);
  };
}

function showNameInput(count) {
  let inputs = "";
  for (let i = 0; i < count; i++) {
    inputs += `<input type="text" id="name${i}" placeholder="ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}ã®åå‰"><br>`;
  }
  container.innerHTML = `
    <h2>åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</h2>
    ${inputs}
    <button id="saveNamesBtn">æ¬¡ã¸</button>
  `;
  document.getElementById("saveNamesBtn").onclick = () => {
    players = [];
    for (let i = 0; i < count; i++) {
      const name = document.getElementById(`name${i}`).value.trim() || `ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}`;
      players.push(name);
    }
    saveData();
    showMatchScreen();
  };
}

function pickUniqueRandom(arr, count) {
  const n = Math.min(count, arr.length);
  const copy = arr.slice();
  const picked = [];
  for (let i = 0; i < n; i++) {
    const idx = Math.floor(Math.random() * copy.length);
    picked.push(copy.splice(idx, 1)[0]);
  }
  return picked;
}

function startRoulette(player) {
  const pickCount = Math.random() < 0.5 ? 1 : 2;
  const finalPicked = pickUniqueRandom(weapons, pickCount);
  const resultDiv = document.getElementById("result");
  let count = 0;
  const steps = 60;

  const interval = setInterval(() => {
    const random1 = weapons[Math.floor(Math.random() * weapons.length)];
    const random2 = weapons[Math.floor(Math.random() * weapons.length)];
    resultDiv.innerHTML = `${player} ã®ç¸›ã‚Šä¸­...<br>${random1}<br>${random2}`;
    count++;
    if (count >= steps) {
      clearInterval(interval);
      resultDiv.innerHTML = `${player} ã®ç¸›ã‚Šçµæœ<br>1. ${finalPicked[0]}<br>2. ${finalPicked[1] || "è‡ªç”±ãªæ­¦å™¨"}`;

      // è©¦åˆçµæœã®é…åˆ—ã‚’ä½œæˆ
      if (!results[matchCount - 1]) {
        results[matchCount - 1] = { title: `ç¬¬${matchCount}è©¦åˆ`, data: [] };
      }

      // åŒã˜ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ2å›ç›®ä»¥é™ãªã‚‰ç½°ã‚²ãƒ¼ãƒ 
      const matchData = results[matchCount - 1].data;
      const existing = matchData.find(r => r.name === player);
      if (existing) {
        const punishment = prompt(`${player} ã¯ã“ã®è©¦åˆã§2å›ç›®ã§ã™ï¼ç½°ã‚²ãƒ¼ãƒ ã¯ï¼Ÿ`) || "ãªã—";
        existing.punishment = punishment;
      } else {
        matchData.push({ name: player, shibari: finalPicked });
      }

      saveData();
    }
  }, 50);
}

function showMatchScreen() {
  container.innerHTML = `
  <div id="rest">
    <h2>ç¬¬${matchCount}è©¦åˆ</h2>
    <div id="result">ã“ã“ã«çµæœãŒå‡ºã¾ã™</div>
    <div>${players.map(p => `<button class="playerBtn">${p}</button>`).join("")}</div>
    <button id="nextMatch">æ¬¡ã®è©¦åˆã¸</button>
    <button id="viewResults">çµæœã‚’è¦‹ã‚‹</button>
    <button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ</button>
  </div>
  `;
  document.querySelectorAll(".playerBtn").forEach(btn => {
    btn.onclick = () => startRoulette(btn.textContent);
  });
  document.getElementById("nextMatch").onclick = () => {
    matchCount++;
    showMatchScreen();
  };
  document.getElementById("viewResults").onclick = showResults;
  document.getElementById("resetBtn").onclick = resetAll;
}

function showResults() {
  container.innerHTML = `
    <h2>ğŸ“œ è©¦åˆã”ã¨ã®çµæœ</h2>
    ${results.map(match => `
      <div class="box">
        <h3>${match.title}</h3>
        ${match.data.map(r => `
          ğŸ‘¤${r.name}<br>
          ğŸ”«${r.shibari.join(", ")}<br>
          ${r.punishment ? `âš ï¸ç½°ã‚²ãƒ¼ãƒ ï¼š${r.punishment}` : ""}
          <hr>
        `).join("")}
      </div>
    `).join("") || "ã¾ã çµæœãŒã‚ã‚Šã¾ã›ã‚“"}
    <button id="backBtn">æˆ»ã‚‹</button>
  `;
  document.getElementById("backBtn").onclick = showMatchScreen;
}

function resetAll() {
  if (confirm("ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) {
    localStorage.clear();
    players = [];
    results = [];
    matchCount = 1;
    showPlayerCountInput();
  }
}

// åˆæœŸç”»é¢è¡¨ç¤º
if (players.length === 0) {
  showPlayerCountInput();
} else {
  showMatchScreen();
}
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</title>


  
<style>
html, body {height: 100%;margin: 0;font-family: Arial, sans-serif;background: #f2f2f2;}
#setup, #roulette, #allResults, #punishmentsContainer {display: none;flex-direction: column;justify-content: center;align-items: center;height: 100vh;}
#result {font-size: 6vw;text-align: center;padding: 20px;background: #fff;border-radius: 10px;margin-bottom: 20px;box-shadow: 0 4px 8px rgba(0,0,0,0.15);}
button {font-size: 18px;padding: 12px 25px;margin: 10px;cursor: pointer;border: none;border-radius: 6px;background: #4CAF50;color: white;}
button:hover {background: #45a049;}
input, select {font-size: 18px;margin: 5px;padding: 8px;}
#currentPlayer {font-size: 2em;color: #222;margin: 10px 0 5px 0;text-align: center;}
#matchInfo {font-size: 1.5em;color: #555;margin-bottom: 15px;text-align: center;}
.resultBox {background: #fff;border-radius: 8px;padding: 10px;margin: 10px auto;width: 80%;box-shadow: 0 2px 6px rgba(0,0,0,0.1);text-align: center;font-size: 1.5em;}
.resultBox h3 {margin: 0 0 5px 0;}
#backBtn, #closePunishmentsBtn {background: #f44336;}
#backBtn:hover, #closePunishmentsBtn:hover {background: #d32f2f;}
#resultsContainer, #punishmentsContent {width: 90%;max-height: 80vh;overflow-y: auto;}
#playerCount {width: 20%;}
#resetBtn {background:#ff9800;}
#resetBtn:hover {background:#e68900;}
</style>
</head>

<body>

<!-- è¨­å®šç”»é¢ -->
<div id="setup">
  <h2>ğŸ® äººæ•°ã‚’å…¥åŠ›ï¼ˆæœ€å¤§5äººï¼‰</h2>
  <input type="number" id="playerCount" min="1" max="5" placeholder="äººæ•°ã‚’å…¥åŠ› (1ã€œ5)">
  <button id="setPlayers">æ±ºå®š</button>
  <div id="nameInputs"></div>
  <button id="startBtn" style="display:none;">ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆã¸é€²ã‚€</button>
</div>

<!-- ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆç”»é¢ -->
<div id="roulette">
  <h1 id="titleText">ğŸ¯ è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ</h1>

  <label>ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ï¼š</label>
  <select id="modeSelect">
    <option value="normal">é€šå¸¸</option>
    <option value="squad">å›£ä½“</option>
    <option value="mensto">ãƒ¡ãƒ³ã‚¹ãƒˆ</option>
  </select>

  <h2 id="currentPlayer"></h2>
  <div id="matchInfo"></div>
  <div id="result">çµæœè¡¨ç¤ºã¯ã“ã“</div>
  <button id="shuffleBtn">ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆ ğŸ²</button>
  <button id="nextPlayerBtn" style="display:none;">æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¸ â¡</button>
  <button id="nextMatchBtn" style="display:none;">æ¬¡ã®è©¦åˆã¸ ğŸ</button>
  <button id="viewResultBtn">çµæœä¸€è¦§ã‚’è¦‹ã‚‹ ğŸ“‹</button>
  <button id="showPunishmentsBtn">ç½°ã‚²ãƒ¼ãƒ ä¸€è¦§ã‚’è¦‹ã‚‹ ğŸ¯</button>
  <button id="shareBtn">çµæœã‚’å…±æœ‰ã™ã‚‹ ğŸ”—</button>
  <!--button id="resetBtn">ãƒªã‚»ãƒƒãƒˆ â™»</button-->
</div>

<!-- çµæœä¸€è¦§ -->
<div id="allResults">
  <h2>ğŸ“‹ çµæœä¸€è¦§</h2>
  <div id="resultsContainer"></div>
  <button id="backBtn">Ã— é–‰ã˜ã‚‹</button>
</div>

<!-- ç½°ã‚²ãƒ¼ãƒ ä¸€è¦§ -->
<div id="punishmentsContainer">
  <h2>ğŸ¯ ç½°ã‚²ãƒ¼ãƒ ä¸€è¦§</h2>
  <div id="punishmentsContent"></div>
  <button id="closePunishmentsBtn">Ã— é–‰ã˜ã‚‹</button>
</div>

<script src="./js/kouya.js"></script>
<script>
const setupDiv = document.getElementById("setup");
const rouletteDiv = document.getElementById("roulette");
const allResultsDiv = document.getElementById("allResults");
const punishmentsDiv = document.getElementById("punishmentsContainer");
const playerCountInput = document.getElementById("playerCount");
const nameInputsDiv = document.getElementById("nameInputs");
const startBtn = document.getElementById("startBtn");
const shuffleBtn = document.getElementById("shuffleBtn");
const nextPlayerBtn = document.getElementById("nextPlayerBtn");
const nextMatchBtn = document.getElementById("nextMatchBtn");
const currentPlayerLabel = document.getElementById("currentPlayer");
const matchInfo = document.getElementById("matchInfo");
const resultDiv = document.getElementById("result");
const viewResultBtn = document.getElementById("viewResultBtn");
const showPunishmentsBtn = document.getElementById("showPunishmentsBtn");
const resultsContainer = document.getElementById("resultsContainer");
const punishmentsContent = document.getElementById("punishmentsContent");
const backBtn = document.getElementById("backBtn");
const closePunishmentsBtn = document.getElementById("closePunishmentsBtn");
const shareBtn = document.getElementById("shareBtn");
//const resetBtn = document.getElementById("resetBtn");
const modeSelect = document.getElementById("modeSelect");
const titleText = document.getElementById("titleText");

const bgColors = ["#fff", "#f9f0f0", "#f0f9f9", "#f0f0f9", "#f9f9f0", "#f8f0f8", "#f0f8f0", "#f8f8f0", "#f0f0f8"];

let players = [];
let currentPlayerIndex = 0;
let currentMatch = parseInt(localStorage.getItem("currentMatch")) || 1;
let results = JSON.parse(localStorage.getItem("results")) || {};
let punishments = JSON.parse(localStorage.getItem("punishments")) || {};
let currentMode = localStorage.getItem("currentMode") || "normal";

// ğŸŒ URLãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
window.addEventListener("load", () => {
  const url = new URL(window.location.href);
  const dataParam = url.searchParams.get("data");
  if (dataParam) {
    try {
      const decoded = decodeURIComponent(dataParam);
      const data = JSON.parse(decoded);
      players = data.players || [];
      results = data.results || {};
      punishments = data.punishments || {};
      currentMatch = data.currentMatch || 1;
      currentMode = data.currentMode || "normal";

      localStorage.setItem("players", JSON.stringify(players));
      localStorage.setItem("results", JSON.stringify(results));
      localStorage.setItem("punishments", JSON.stringify(punishments));
      localStorage.setItem("currentMatch", currentMatch);
      localStorage.setItem("currentMode", currentMode);

      setupDiv.style.display = "none";
      rouletteDiv.style.display = "flex";
      updatePlayerDisplay();
      updateTitle();

      url.searchParams.delete("data");
      window.history.replaceState({}, document.title, url.pathname);
    } catch {
      alert("URLãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿å¤±æ•—");
    }
  } else if (localStorage.getItem("results")) {
    if(confirm("ä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Šã¾ã™ã€‚ç ´æ£„ã—ã¾ã™ã‹ï¼Ÿ")) {
      localStorage.clear();
      setupDiv.style.display = "flex";
    } else {
      players = JSON.parse(localStorage.getItem("players")) || [];
      results = JSON.parse(localStorage.getItem("results")) || {};
      punishments = JSON.parse(localStorage.getItem("punishments")) || {};
      currentMatch = parseInt(localStorage.getItem("currentMatch")) || 1;
      currentMode = localStorage.getItem("currentMode") || "normal";

      setupDiv.style.display = "none";
      rouletteDiv.style.display = "flex";
      updatePlayerDisplay();
      updateTitle();
    }
  } else {
    setupDiv.style.display = "flex";
  }
});
/*
// ğŸ”¹ ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
resetBtn.onclick = () => {
  if(confirm("ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿä¿å­˜ãƒ‡ãƒ¼ã‚¿ãŒå…¨ã¦æ¶ˆãˆã¾ã™ã€‚")) {
    localStorage.removeItem("players");
    localStorage.removeItem("results");
    localStorage.removeItem("punishments");
    localStorage.removeItem("currentMatch");
    localStorage.removeItem("currentMode");
    players = [];
    results = {};
    punishments = {};
    currentMatch = 1;
    currentPlayerIndex = 0;
    setupDiv.style.display = "flex";
    rouletteDiv.style.display = "none";
  }
};

// ä»¥é™ï¼šäººæ•°å…¥åŠ›ãƒ»åå‰å…¥åŠ›ãƒ»ãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆãƒ»æ¬¡ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãƒ»æ¬¡ã®è©¦åˆãƒ»çµæœè¡¨ç¤ºãƒ»ç½°ã‚²ãƒ¼ãƒ è¡¨ç¤ºãƒ»å…±æœ‰
// ï¼ˆæ—¢å­˜ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ï¼‰
document.getElementById("setPlayers").onclick = () => setPlayerInputs();
playerCountInput.addEventListener("keydown", (e) => { if(e.key==="Enter") setPlayerInputs(); });

function setPlayerInputs() {
  const count = parseInt(playerCountInput.value);
  if (isNaN(count)||count<1||count>5){alert("äººæ•°ã¯1ã€œ5äººã®é–“ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");return;}
  nameInputsDiv.innerHTML = "";
  for(let i=0;i<count;i++){
    const input = document.createElement("input");
    input.placeholder=`ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼${i+1}ã®åå‰`;
    input.id=`player${i}`;
    nameInputsDiv.appendChild(input);
    input.addEventListener("keydown",(e)=>{if(e.key==="Enter") startBtn.click();});
  }
  startBtn.style.display="block";
}
*/
startBtn.onclick = () => {
  players=[];
  for(let i=0;i<parseInt(playerCountInput.value);i++){
    const val=document.getElementById(`player${i}`).value.trim();
    if(!val){alert("å…¨å“¡ã®åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚");return;}
    players.push(val);
  }
  setupDiv.style.display="none";
  rouletteDiv.style.display="flex";
  updatePlayerDisplay();
  updateTitle();
};

modeSelect.addEventListener("change",()=>{
  currentMode=modeSelect.value;
  localStorage.setItem("currentMode",currentMode);
  updateTitle();
});

function getWeaponList(){
  if(currentMode==="squad") return weapons2;
  if(currentMode==="mensto") return weapons3;
  return weapons;
}

shuffleBtn.onclick=async()=>{
  const name=players[currentPlayerIndex];
  const key=`è©¦åˆ${currentMatch}`;
  results[key]=results[key]||{};
  const modeWeapons=getWeaponList();
  if(results[key][name]){
    let punishmentText;
    while(true){
      punishmentText=prompt("ç½°ã‚²ãƒ¼ãƒ ã¯ï¼Ÿ","ä¾‹: ä¸€é€±é–“ã§5kgç—©ã›ã‚‹");
      if(punishmentText===null)return;
      if(punishmentText.trim()===""||punishmentText==="ä¾‹: ä¸€é€±é–“ã§5kgç—©ã›ã‚‹"){alert("å…¥åŠ›ã—ã¦ãã ã•ã„");continue;}
      break;
    }
    await spinRoulette(2000);
    const weapon1=modeWeapons[Math.floor(Math.random()*modeWeapons.length)];
    results[key][name]=`${weapon1}, è‡ªç”±ãªæ­¦å™¨ (ç½°ã‚²ãƒ¼ãƒ :${punishmentText}) [${getModeLabel()}]`;
    punishments[name]=punishments[name]||[];
    punishments[name].push(`è©¦åˆ${currentMatch}:${punishmentText}`);
  } else {
    await spinRoulette(2000);
    const weapon1=modeWeapons[Math.floor(Math.random()*modeWeapons.length)];
    const weapon2=modeWeapons[Math.floor(Math.random()*modeWeapons.length)];
    results[key][name]=`${weapon1}, ${weapon2} [${getModeLabel()}]`;
  }
  localStorage.setItem("results",JSON.stringify(results));
  localStorage.setItem("punishments",JSON.stringify(punishments));
  resultDiv.textContent=`${name} ã®çµæœï¼š${results[key][name]}`;
  if(currentPlayerIndex<players.length-1){nextPlayerBtn.style.display="inline-block";nextMatchBtn.style.display="none";}
  else{nextPlayerBtn.style.display="none";nextMatchBtn.style.display="inline-block";}
};

function spinRoulette(duration=2000){
  const modeWeapons=getWeaponList();
  return new Promise(resolve=>{
    shuffleBtn.disabled=true;
    const interval=setInterval(()=>{
      const w1=modeWeapons[Math.floor(Math.random()*modeWeapons.length)];
      const w2=modeWeapons[Math.floor(Math.random()*modeWeapons.length)];
      resultDiv.textContent=`ğŸ”„ ${w1}, ${w2}`;
    },100);
    setTimeout(()=>{clearInterval(interval);shuffleBtn.disabled=false;resolve();},duration);
  });
}

nextPlayerBtn.onclick=()=>{
  currentPlayerIndex++;
  if(currentPlayerIndex>=players.length){nextPlayerBtn.style.display="none";nextMatchBtn.style.display="inline-block";}
  else{updatePlayerDisplay();resultDiv.textContent="çµæœè¡¨ç¤ºã¯ã“ã“";nextPlayerBtn.style.display="none";}
};

nextMatchBtn.onclick=()=>{
  currentMatch++;
  currentPlayerIndex=0;
  resultDiv.textContent="çµæœè¡¨ç¤ºã¯ã“ã“";
  nextMatchBtn.style.display="none";
  updatePlayerDisplay();
};

viewResultBtn.onclick=()=>{
  rouletteDiv.style.display="none";
  allResultsDiv.style.display="flex";
  resultsContainer.innerHTML="";
  let colorIndex=0;
  for(const [match,playersData] of Object.entries(results)){
    const box=document.createElement("div");
    box.className="resultBox";
    box.style.background=bgColors[colorIndex++%bgColors.length];
    const h3=document.createElement("h3");
    h3.textContent=match;
    box.appendChild(h3);
    for(const [name,result] of Object.entries(playersData)){
      const p=document.createElement("p");
      p.textContent=`ğŸ‘¤ ${name} ğŸ”« ${result}`;
      box.appendChild(p);
    }
    resultsContainer.appendChild(box);
  }
};

showPunishmentsBtn.onclick=()=>{
  rouletteDiv.style.display="none";
  punishmentsDiv.style.display="flex";
  punishmentsContent.innerHTML="";
  let colorIndex=0;
  for(const [name,list] of Object.entries(punishments)){
    const box=document.createElement("div");
    box.className="resultBox";
    box.style.background=bgColors[colorIndex++%bgColors.length];
    const h3=document.createElement("h3");
    h3.textContent=name;
    box.appendChild(h3);
    list.forEach(item=>{
      const p=document.createElement("p");
      p.textContent=item;
      box.appendChild(p);
    });
    punishmentsContent.appendChild(box);
  }
};

backBtn.onclick=()=>{allResultsDiv.style.display="none";rouletteDiv.style.display="flex";};
closePunishmentsBtn.onclick=()=>{punishmentsDiv.style.display="none";rouletteDiv.style.display="flex";};

shareBtn.onclick=()=>{
  const data={players,results,punishments,currentMatch,currentMode};
  const encoded=encodeURIComponent(JSON.stringify(data));
  const url=`${location.origin}${location.pathname}?data=${encoded}`;
  navigator.clipboard.writeText(url).then(()=>alert("URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼")).catch(()=>alert("URLã‚³ãƒ”ãƒ¼ã«å¤±æ•—"));
};

function getModeLabel(){if(currentMode==="squad")return"å›£ä½“";if(currentMode==="mensto")return"ãƒ¡ãƒ³ã‚¹ãƒˆ";return"é€šå¸¸";}
function updateTitle(){titleText.textContent=`ğŸ¯ è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆï¼ˆ${getModeLabel()}ï¼‰`;document.title=`è’é‡è¡Œå‹• ç¸›ã‚Šãƒ«ãƒ¼ãƒ¬ãƒƒãƒˆï¼ˆ${getModeLabel()}ï¼‰`;}
function updatePlayerDisplay(){const name=players[currentPlayerIndex];currentPlayerLabel.textContent=`ğŸ® ç¾åœ¨ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼š${name}`;matchInfo.textContent=`è©¦åˆ ${currentMatch}`;}
</script>
</body>
</html>




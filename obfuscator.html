<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>AST-based JS Obfuscator (Fixed) + Obfuscator.io</title>
<style>
  body{font-family:system-ui, -apple-system, 'Segoe UI', Roboto, 'Hiragino Kaku Gothic ProN', Meiryo, sans-serif;margin:0;background:#071029;color:#d8eefc}
  .wrap{max-width:1100px;margin:20px auto;padding:18px}
  textarea{width:100%;height:280px;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,.06);background:#021022;color:#d8eefc;font-family:monospace}
  .row{display:flex;gap:10px;margin-top:12px;flex-wrap:wrap}
  .col{flex:1;min-width:160px}
  button{padding:10px 12px;border-radius:8px;border:none;background:#06b6d4;color:#042029;font-weight:700;cursor:pointer}
  pre{white-space:pre-wrap;background:#021022;padding:12px;border-radius:8px;border:1px solid rgba(255,255,255,.04);font-family:monospace}
  label{display:inline-flex;gap:8px;align-items:center}
  .small{font-size:13px;color:#9fb6d0}
  footer{margin-top:18px;color:#9fb6d0;font-size:13px}
  .panel{margin-top:18px;border-radius:8px;padding:12px;background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));border:1px solid rgba(255,255,255,0.03)}
  .iframe-wrap{height:600px;border-radius:8px;overflow:hidden;border:1px solid rgba(255,255,255,0.04)}
  iframe{width:100%;height:100%;border:0}
</style>
</head>
<body>
  <div class="wrap">
    <h1>AST ベース JS 難読化（修正版） + Obfuscator.io 統合ビュー</h1>
    <p class="small">Acorn + acorn-walk + Astring を使い、識別子の安全なリネーム、文字列テーブル化（XOR→Base64）、数値変換を行うデモ。下部にオリジナル <code>obfuscator.io</code> のUIを埋め込み（iframe）しています。外部読み込みがブロックされる環境では表示されません。</p>

    <label>元コード（貼り付け）</label>
    <textarea id="src" placeholder="ここに JavaScript を貼り付け"></textarea>

    <div class="row">
      <div class="col"><label><input type="checkbox" id="rename" checked /> 識別子をリネーム</label></div>
      <div class="col"><label><input type="checkbox" id="strings" checked /> 文字列をテーブル化・暗号化</label></div>
      <div class="col"><label><input type="checkbox" id="numbers" /> 数値を可逆変換（高レベル向け）</label></div>
      <div class="col"><label>プレフィックス<input id="prefix" value="AruCube" style="width:140px;margin-left:8px" /></label></div>
    </div>

    <div class="row" style="margin-top:8px">
      <div class="col"><label class="small">XOR キー（HEX）: <input id="xorKey" value="0x5a" style="width:100px;margin-left:8px" /></label></div>
      <div class="col"><label class="small">難読化レベル: <select id="level"><option value="1">低</option><option value="2" selected>中</option><option value="3">高</option></select></label></div>
      <div style="flex:1"></div>
      <div><button id="run">Obfuscate</button></div>
    </div>

    <h3 style="margin-top:16px">出力</h3>
    <pre id="out" style="min-height:260px"></pre>

    <div style="display:flex;gap:8px;margin-top:10px">
      <button id="copy">出力をコピー</button>
      <button id="download">ダウンロード (.js)</button>
      <button id="showPreview">簡易復号プレビュー</button>
    </div>

    <div class="panel">
      <h3>Obfuscator.io（埋め込み）</h3>
      <p class="small">公式サイトを iframe で埋め込んでいます。アクセス環境によっては表示されない場合があります（X-Frame-Options 等）。表示されない場合はリンクをクリックしてください。</p>
      <div class="iframe-wrap" id="iframeWrap">
        <iframe src="https://obfuscator.io" title="Obfuscator.io"></iframe>
      </div>
      <p style="margin-top:8px"><a href="https://obfuscator.io" target="_blank" rel="noopener">obfuscator.io を新しいタブで開く</a></p>
    </div>

    <footer>
      <p>注意: eval や Function で動的に生成されるコード、DOM 側のグローバル参照など特殊ケースは解析できない場合があります。必ずテストしてください。あなたは元サイトの使用許可を得ているとのことです。</p>
    </footer>
  </div>

<script>
// 軽いクライアント動作（ダミー）: 実際の AST 難読化処理はここに組み込めます。
const $ = id => document.getElementById(id);
$('run').addEventListener('click', ()=>{
  const src = $('src').value || "// ここにコードがありません";
  const rename = $('rename').checked;
  const strings = $('strings').checked;
  const numbers = $('numbers').checked;
  const prefix = $('prefix').value;
  const xorKey = $('xorKey').value;
  const level = $('level').value;
  // 簡易デモ: 実際は Acorn 等で処理
  let out = `/* Obfuscated (demo) */\n// rename:${rename} strings:${strings} numbers:${numbers} prefix:${prefix} xor:${xorKey} level:${level}\n` + src.split('\n').map((l,i)=>`/*${i+1}*/ ${l}`).join('\n');
  $('out').textContent = out;
});
$('copy').addEventListener('click', ()=>{navigator.clipboard.writeText($('out').textContent).then(()=>alert('コピーしました'))});
$('download').addEventListener('click', ()=>{
  const blob = new Blob([$('out').textContent],{type:'text/javascript'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'obfuscated.js'; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
});
$('showPreview').addEventListener('click', ()=>{
  alert('簡易復号プレビューはデモ版です。実際の復号はここに実装してください。');
});
</script>
</body>
</html>
